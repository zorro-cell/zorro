[General]
script-enabled = true
loglevel = debug

[Script]
# å¾®åšçƒ­æœä¸å›½é™…æ–°é—»è·å–ï¼ˆæç®€ç‰ˆï¼‰
script-content = "function fetchWeibo(callback) {
    $httpClient.get({
        url: 'https://v2.xxapi.cn/api/weibohot',
        headers: {
            'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X)'
        }
    }, (err, resp, data) => {
        if (err) {
            console.log('å¾®åšè¯·æ±‚é”™è¯¯:', err);
            callback([]);
            return;
        }
        try {
            const json = JSON.parse(data);
            if (json.code !== 200) {
                console.log('å¾®åšAPIé”™è¯¯:', json.msg);
                callback([]);
                return;
            }
            const result = json.data.slice(0, 5).map((item, i) => 
                `${i+1}. ${item.title} (${item.hot})`
            );
            callback(result);
        } catch (e) {
            console.log('å¾®åšè§£æå¤±è´¥:', e);
            callback([]);
        }
    });
}

function fetchBing(callback) {
    $httpClient.get({
        url: 'https://www.bing.com/news/search?q=world+news&format=rss',
        headers: {
            'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X)'
        }
    }, (err, resp, data) => {
        if (err) {
            console.log('Bingè¯·æ±‚é”™è¯¯:', err);
            callback([]);
            return;
        }
        try {
            const titles = data.match(/<title>([^<]+)<\/title>/g) || [];
            const result = titles.slice(1, 6).map((title, i) => 
                `${i+6}. ${title.replace(/<\/?title>/g, '')}`
            );
            callback(result);
        } catch (e) {
            console.log('Bingè§£æå¤±è´¥:', e);
            callback([]);
        }
    });
}

// ä¸»å‡½æ•°
function main() {
    console.log('===== æ–°é—»è„šæœ¬å¼€å§‹æ‰§è¡Œ =====');
    fetchWeibo(weibo => {
        fetchBing(bing => {
            const news = [...weibo, ...bing];
            if (news.length > 0) {
                $notification.post('ğŸ“° æ–°é—»æ›´æ–°', `å…±${news.length}æ¡`, news.join('\\n'));
                console.log('æ–°é—»è·å–æˆåŠŸ:', news);
            } else {
                $notification.post('ğŸ“° æ–°é—»è·å–å¤±è´¥', 'æ— æœ‰æ•ˆå†…å®¹', 'è¯·æ£€æŸ¥ç½‘ç»œ');
                console.log('æœªè·å–åˆ°ä»»ä½•æ–°é—»å†…å®¹');
            }
            $done();
        });
    });
}

// ç«‹å³æ‰§è¡Œ
main();"
tag = news_minimal
enabled = true

[Cron]
# æ¯2åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆç®€åŒ–ç‰ˆï¼‰
*/2 * * * * script-tag=news_minimal, timeout=30

[MITM]
hostname = v2.xxapi.cn, www.bing.com
enable = true

[Log]
script-log-level = debug
console-output = true
